"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useGetPathForRecord = void 0;
var react_1 = require("react");
var core_1 = require("../core");
var controller_1 = require("../controller");
var useGetPathForRecordCallback_1 = require("./useGetPathForRecordCallback");
/**
 * Get a path for a record, based on the current resource and the link type.
 *
 * Accepted link types are 'edit', 'show', a route string, false, or a function returning one of these types.
 *
 * @example
 * // basic usage (leverages RecordContext, ResourceContext and ResourceDefinitionContext)
 * const EditLink = () => {
 *   const path = useGetRouteForRecord();
 *   return path ? <Link to={path}>Edit</Link> : null;
 * };
 *
 * // controlled mode
 * const EditLink = ({ record, resource }) => {
 *    const path = useGetRouteForRecord({ record, resource, link: 'edit' });
 *    return path ? <Link to={path}>Edit</Link> : null;
 * };
 *
 * // the link option can be a function
 * const EditLink = ({ record, resource }) => {
 *   const path = useGetRouteForRecord({ record, resource, link: (record, resource) => record.canEdit ? 'edit' : false });
 *   return path ? <Link to={path}>Edit</Link> : null;
 * };
 *
 * // the link option can be a function returning a promise
 * const EditLink = ({ record, resource }) => {
 *   const path = useGetRouteForRecord({ record, resource, link: async (record, resource) => {
 *     const canEdit = await canEditRecord(record, resource);
 *     return canEdit ? 'edit' : false;
 *   }});
 *   return path ? <Link to={path}>Edit</Link> : null;
 * };
 */
var useGetPathForRecord = function (options) {
    var link = (options || {}).link;
    var record = (0, controller_1.useRecordContext)(options);
    var resource = (0, core_1.useResourceContext)(options);
    if (!resource) {
        throw new Error('Cannot generate a link for a record without a resource. You must use useGetPathForRecord within a ResourceContextProvider, or pass a resource prop.');
    }
    var getPathForRecord = (0, useGetPathForRecordCallback_1.useGetPathForRecordCallback)(options);
    // we initialize the path with the link value
    var _a = (0, react_1.useState)(function () {
        getPathForRecord({
            record: record,
            resource: resource,
            link: link,
        }).then(function (resolvedLink) {
            if (resolvedLink === false) {
                // already set to false by default
                return;
            }
            // update the path when the promise resolves
            setPath(resolvedLink);
        });
        return false;
    }), path = _a[0], setPath = _a[1];
    // update the path if the record changes
    (0, react_1.useEffect)(function () {
        getPathForRecord({
            record: record,
            resource: resource,
            link: link,
        }).then(function (resolvedLink) {
            // update the path when the promise resolves
            setPath(resolvedLink);
        });
    }, [getPathForRecord, link, record, resource]);
    return path;
};
exports.useGetPathForRecord = useGetPathForRecord;
//# sourceMappingURL=useGetPathForRecord.js.map